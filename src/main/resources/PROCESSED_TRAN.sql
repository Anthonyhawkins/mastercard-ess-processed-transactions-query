DROP TABLE IF EXISTS PROCESSED_TRAN;

CREATE TABLE PROCESSED_TRAN (
PRCSS_TRAN_ID                   NUMERIC(19)  NOT NULL,
MTI_ID                          VARCHAR(4),
DE2_PAN_NUM                     VARCHAR(19),
DE3_PRCSS_CD                    VARCHAR(6),
DE4_TRAN_AMT                    NUMERIC(18,6),
DE5_SETL_AMT                    NUMERIC(18,6),
DE6_BILL_AMT                    NUMERIC(18,6),
DE7_TRAN_DTTM                   TIMESTAMP,
DE7_TRAN_DTTM_TXT               VARCHAR(10),
DE9_SETL_CONV_RATE              VARCHAR(8),
DE10_CRDHLDR_CONV_RATE          VARCHAR(8),
DE11_STAN_ID                    VARCHAR(6),
DE12_13_LOC_TRAN_DTTM           DATE,
DE12_13_LOC_TRAN_DTTM_TXT       VARCHAR(10),
DE14_EXPIR_DT                   VARCHAR(4),
DE15_SETL_DT                    VARCHAR(4),
DE16_CONV_DT                    VARCHAR(4),
DE18_MERCH_TYPE_CD              VARCHAR(4),
DE20_PAN_CNTRY_CD               VARCHAR(3),
DE22_POS_ENT_MODE_CD            VARCHAR(3),
DE23_CARD_SEQ_NUM               VARCHAR(3),
DE26_POS_PIN_CAP_CD             VARCHAR(2),
DE32_ACQ_INST_ID                VARCHAR(11),
DE33_FWD_INST_ID                VARCHAR(11),
DE37_RETRV_REF_NUM              VARCHAR(12),
DE38_AUTH_ID_RESP_CD            VARCHAR(6),
DE39_ISSR_RESP_CD               VARCHAR(2),
DE41_CARD_ACPT_TERM_ID          VARCHAR(8),
DE42_CARD_ACPT_ID_CD            VARCHAR(15),
DE43_CARD_ACPT_NAM_LOC          VARCHAR(40),
DE44_ADTNL_RESP_DATA            VARCHAR(25),
DE48_TRAN_CAT_CD                VARCHAR(1),
DE48_SE33_SF1_PAN_MAP_ACCT_CD   VARCHAR(1),
DE48_SE33_SF3_PAN_MAP_EXPIR_DT  VARCHAR(4),
DE48_SE38_ACCT_CAT_CD           VARCHAR(1),
DE48_SE42_ECMRC_SECTY_LVL_CD    VARCHAR(7),
DE48_SE43_UNIV_CRDHLDR_AUTH_CD  VARCHAR(32),
DE48_SE58_ATM_ADTNL_DATA_TXT    VARCHAR(33),
DE48_SE75_FRAUD_ASSMT_SCR_NUM   VARCHAR(3),
DE48_SE82_ADDR_VER_RQST_CD      VARCHAR(2),
DE48_SE83_ADDR_VER_RESP_CD      VARCHAR(1),
DE48_SE87_MAGSTRIP_CVC_CD       VARCHAR(1),
DE48_SE88_MAGSTRIP_CVC_CHNG_CD  VARCHAR(1),
DE48_SE89_MAGSTRIPE_CVC_ERR_CD  VARCHAR(1),
DE48_SE92_CVC2_PRSNT_IND_CD     VARCHAR(1),
DE49_TRAN_CURR_CD               VARCHAR(3),
DE50_SETL_CURR_CD               VARCHAR(3),
DE51_CRDHLDR_CURR_CD            VARCHAR(3),
DE54_ADTNL_AMT                  VARCHAR(120),
DE60_ADVIS_RSN_CD               VARCHAR(60),
DE61_POS_DATA_TXT               VARCHAR(26),
DE63_BNKNT_DATA_TXT             VARCHAR(50),
DE63_SF1_CARD_TYPE_CD           VARCHAR(3),
DE63_SF2_BNKNT_REF_NUM          VARCHAR(9),
DE102_ACCT_ID_1_ID              VARCHAR(28),
DE103_ACCT_ID_2_ID              VARCHAR(28),
DE112_ADTNL_NATL_USE_TXT        VARCHAR(103),
DE120_REC_DATA_TXT              VARCHAR(999),
DE121_AUTH_AGENT_ID_CD          VARCHAR(11),
DE124_MBR_DEF_DATA_TXT          VARCHAR(199),
BNKNT_REF_NUM_AND_TRAN_DT_ID    VARCHAR(20),
IPREVENT_SCR_NUM                NUMERIC(3),
IPREVENT_ERR_CD                 VARCHAR(3),
IPREVENT_RSN_CD                 VARCHAR(3),
IPREVENT_MODEL_NAM              VARCHAR(256),
IPREVENT_SUBMODEL_NAM           VARCHAR(256),
IPREVENT_RQST_TYPE_CD           VARCHAR(1),
IPREVENT_TECH1_NAM              VARCHAR(256),
IPREVENT_TECH1_SCR              NUMERIC(3),
IPREVENT_TECH1_RSN_CD           VARCHAR(25),
IPREVENT_TECH1_SUB_CD           NUMERIC(3),
IPREVENT_TECH2_NAM              VARCHAR(256),
IPREVENT_TECH2_SCR              NUMERIC(3),
IPREVENT_TECH2_RSN_CD           VARCHAR(25),
IPREVENT_TECH2_SUB_CD           NUMERIC(3),
IPREVENT_TECH3_NAM              VARCHAR(256),
IPREVENT_TECH3_SCR              NUMERIC(3),
IPREVENT_TECH3_RSN_CD           VARCHAR(25),
IPREVENT_TECH3_SUB_CD           NUMERIC(3),
IPREVENT_TECH4_NAM              VARCHAR(256),
IPREVENT_TECH4_SCR              NUMERIC(3),
IPREVENT_TECH4_RSN_CD           VARCHAR(25),
IPREVENT_TECH4_SUB_CD           NUMERIC(3),
IPREVENT_PRCSS_TM               NUMERIC(6),
FICO_MODEL_NAM                  VARCHAR(256),
FICO_SCR_NUM                    NUMERIC(3),
FICO_RSN_1_CD                   VARCHAR(2),
FICO_RSN_2_CD                   VARCHAR(2),
FICO_RSN_3_CD                   VARCHAR(2),
BRMS_SCR                        NUMERIC(3),
BRMS_RSN_1_CD                   VARCHAR(2),
BRMS_RSN_2_CD                   VARCHAR(2),
GNRC_RSN_CD                     VARCHAR(2),
BRMS_PRCSS_TM                   NUMERIC(6),
PRCSS_DT_TM                     TIMESTAMP  NOT NULL,
CNTRT_ACCT_GRP_ID               NUMERIC(19),
MSG_TYPE_NAM                    VARCHAR(30),
STAT_CD                         VARCHAR(1),
CUST_CLSTR_ID                   NUMERIC(19)  NOT NULL,
FLEXTP_INSTNCE_ID               NUMERIC(19),
SRVR_NAM                        VARCHAR(100),
CRTE_DT_TM                      DATE,
SUB_PRDCT_EXE_FLOW_ID           NUMERIC(19),
CUST_CONFIG_GRP_SUBPRODUCT_ID   NUMERIC(19),
EXE_STEP_TXT                    VARCHAR(1056),
SCR_THRHD_NUM                   NUMERIC(3),
FICO_PRCSS_SW                   VARCHAR(1),
ABOVE_THRHD_SW                  VARCHAR(1),
BRMS_PRCSS_SW                   VARCHAR(1),
INP_TYPE_NAM                    VARCHAR(25),
INP_CMPNT_ID                    NUMERIC(19),
INP_HDR_BYTEA                    BYTEA,
INP_TRAN_BYTEA                   BYTEA,
FILE_NAM                        VARCHAR(1024),
FILE_CRTE_DT                    DATE,
FILE_TYPE_TXT                   VARCHAR(3),
TRAN_IN_FILE_CNT                NUMERIC(22),
MIP_IP_ADDR                     VARCHAR(26),
REPLY_TO_QM_TXT                 VARCHAR(256),
REPLY_TO_QUEUE_TXT              VARCHAR(256),
GW_MIP_ID                       VARCHAR(3),
BNKNT_0620_OUTPT_SW             VARCHAR(1),
BNKNT_0130_OUTPT_SW             VARCHAR(1),
BNKNT_0810_OUTPT_SW             VARCHAR(1),
ASA_OUTPT_SW                    VARCHAR(1),
ONLINE_INP_TO_OUTPT_EXE_TM      NUMERIC(19),
EVENT_MGMT_OUTPT_SW             VARCHAR(1),
ALERT_OUTPT_SW                  VARCHAR(1),
BAT_FILE_OUTPT_SW               VARCHAR(1),
BNKNT_0620_DLVR_DT              DATE,
BNKNT_0630_CNFRMTN_DT           DATE,
BNKNT_RESEND_IN_PRCSS_DT        DATE,
OUTPT_HDR_BYTEA                  BYTEA,
OUTPT_MSG_BYTEA                  BYTEA,
ALERT_CRITERIA_CD               VARCHAR(2),
ALERT_TS                        TIMESTAMP(6),
RISK_LIC_ACCT_GRP_ID            NUMERIC(19),
DMN_ID                          NUMERIC(19),
ACCT_GRP_NAM                    VARCHAR(128),
INST_NAM                        VARCHAR(128),
DE35_T2_EXTENDED_SVC_CD         VARCHAR(3),
DE48_SE20_CRDHLDR_VER_MTHD_CD   VARCHAR(1),
DE48_SE39_ADC_DATA_TXT          VARCHAR(50),
DE48_SE71_ON_BEHALF_SERV_CD     VARCHAR(40),
DE48_SE84_MERCH_ADV_CD          VARCHAR(2),
DE48_SE95_MC_PROMOTION_CD       VARCHAR(6),
DE55_CHIP_PRSNT_IND_SW          VARCHAR(1),
ADC_SW                          VARCHAR(1),
EVENT_MGMT_ELIGIBLE_SW          VARCHAR(1)  NOT NULL,
MPS_MBR_ID                      VARCHAR(11),
SITE_CD                         VARCHAR(10),
EMS_DCLN_SW                     VARCHAR(1),
LST_RESP_MSG_UPDT_DT            DATE,
EMS_ADJSTD_SCR_NUM              NUMERIC(3),
EMS_ADJSTD_SCR_RSN_CD           VARCHAR(2),
EMS_ADJSTD_INTMD_RSN_CD         VARCHAR(60),
BRMS_ADJSTD_INTMD_RSN_CD        VARCHAR(60),
BRMS_ADJSTD_SCR_SW              VARCHAR(1),
EMS_TST_SCR_NUM                 NUMERIC(3),
EMS_TST_RSN_1_CD                VARCHAR(2),
EMS_TST_RSN_2_CD                VARCHAR(2),
EMS_TST_INTMD_RSN_CD            VARCHAR(60),
CUST_CRTE_CASE_SW               VARCHAR(1),
MC_ACTN_CD                      VARCHAR(10),
BRMS_TRACE_DATA_TXT             VARCHAR(4000),
IPREVENT_PURE_SCR_NUM           NUMERIC(3),
IPREVENT_PURE_RSN_CD            VARCHAR(2),
BRMS_PRCSS_CD                   VARCHAR(1),
BRMS_PRCSS_INFO                 VARCHAR(1000),
PRCSS_NTWRK_CD                  VARCHAR(1),
DE48_SE51_MERCH_ON_BHLF_SRV_CD  VARCHAR(40),
DE48_SE55_MERCH_FRAUD_SCR_NUM   VARCHAR(3),
DE48_SE61_POS_DATA_EXT_CD       VARCHAR(5),
DE126_SE11_MERCH_BILL_ICA_NUM   VARCHAR(11),
DE126_SE71_MERCH_ACQ_RSLT_TXT   VARCHAR(40),
SCR_TYPE_CD                     VARCHAR(1)  DEFAULT 'I',
MERCH_BILL_SW                   VARCHAR(1),
LTV_VER_ID                      VARCHAR(10),
LTV_LKP_TM                      NUMERIC(19),
LTV_INSTNCE_ID                  NUMERIC(19),
HIGH_RISK_ISSR_ONLY_SW          VARCHAR(1),
STRT_ACCT_RNG_NUM               VARCHAR(19),
ENDNG_ACCT_RNG_NUM              VARCHAR(19),
ISSR_ICA                        VARCHAR(11),
IPREVENT_PRCSS_SW               VARCHAR(1),
DE45_T1_EXTENDED_SVC_CD         VARCHAR(3),
DE48_SE77_PAY_TXN_TYP_IND       VARCHAR(3),
DE55_9F36_TRAN_CTR_NUM          VARCHAR(5),
DE55_95_TERM_VER_RSLT_TXT       VARCHAR(10),
DE55_9F03_OTHER_AMT             VARCHAR(12),
DE55_9F10_ISSR_APPL_DATA_TXT    VARCHAR(36),
DE55_9F41_TRAN_SEQ_NUM          VARCHAR(10),
DE55_9F33_TERMS_CPBL_TXT        VARCHAR(6),
DE55_9F34_CVM_RSLT_TXT          VARCHAR(6),
DE45_7_TRACK1_EXPIR_DT          VARCHAR(4),
DE35_4_TRACK2_EXPIR_DT          VARCHAR(4),
DE126_SE17_SF_1_ACQ_RGN_TXT     VARCHAR(2),
DE126_SE17_SF_2_ISS_RGN_TXT     VARCHAR(2),
DE126_SE18_SF_1_RTN_TXT         VARCHAR(9),
EMS_ACQ_RGN_TXT                 VARCHAR(10),
EMS_ISS_RGN_TXT                 VARCHAR(10),
DE48_SE33_SF2_VIRT_PAN_NUM      VARCHAR(19),
WEBLKUP_ID                      NUMERIC(19),
BRMS_RESP_CD                    VARCHAR(2),
TST_BRMS_RESP_CD                VARCHAR(2),
BRMS_RSN_3_CD                   VARCHAR(2),
ISSR_RTN_DE126S18SF2            VARCHAR(10),
EMS_PAN_CNTRY_CD                VARCHAR(3),
BILL_SERV_RSN_CD                VARCHAR(96),
PRDCT_CAT_CD                    VARCHAR(1),
DE55_SUB_FLDS                   VARCHAR(512),
DE048S56_ISSR_SECTY_SERV_TXT    VARCHAR(96),
DE048S57_ACQ_SECTY_SERV_TXT     VARCHAR(96),
VEL_PRCSS_TM                    NUMERIC(19),
VEL_PRCSS_INFO                  VARCHAR(1000),
DE48_SE26_SF1_WLT_ID            VARCHAR(3),
SEND_MSG_REF_ID                 VARCHAR(8),
MSG_CLNT_ID                     VARCHAR(64),
ENR_ACQ_CUST_ID                 NUMERIC(10),
ENR_ISSR_CUST_ID                NUMERIC(10),
AUTH_ACCT_RNG_ID                NUMERIC(19),
MPS_STRT_ACCT_RNG_NUM           NUMERIC(19),
MPS_ENDNG_ACCT_RNG_NUM          NUMERIC(19),
DE48_SE33_SF5_TKN_ASSRNC_LVL    VARCHAR(2),
DE48_SE33_SF6_TKN_RQSTR_ID      VARCHAR(11),
AOM_INSTNCE_ID                  NUMERIC(19),
AOM_SITE_CD                     VARCHAR(10),
DE48_SE33_SF4_PRDCT_CD          VARCHAR(3),
DE48_SE33_SF7_PAN_ACCT_RNG      VARCHAR(19),
DE48_SE33_SF8_TKN_STRG_TYPE_CD  VARCHAR(2)
) 
WITH (appendonly=true, compresstype=quicklz)
DISTRIBUTED BY (PRCSS_TRAN_ID)
PARTITION BY RANGE (DE7_TRAN_DTTM)
(   START (date '2011-01-01') INCLUSIVE
    END (date '2017-03-01')  EXCLUSIVE
    EVERY (INTERVAL '1 MONTH') );


CREATE TABLE STAGE_PROCESSED_TRAN
(LIKE PROCESSED_TRAN)
DISTRIBUTED BY (PRCSS_TRAN_ID);


CREATE EXTERNAL TABLE PROCESSED_TRAN_EXT (
LIKE PROCESSED_TRAN)
-- WWT
-- LOCATION ('gpfdist://10.253.80.118:8080/gpfdist/','gpfdist://10.253.80.119:8080/gpfdist/')
-- GCP
-- LOCATION ('gpfdist://10.0.0.245:8080/gpfdist/','gpfdist://10.0.0.246:8080/gpfdist/','gpfdist://10.0.0.247:8080/gpfdist/','gpfdist://10.0.0.2:8080/gpfdist/')
-- AZURE
LOCATION ('gpfdist://10.1.2.4:8080/gpfdist/','gpfdist://10.1.2.5:8080/gpfdist/','gpfdist://10.1.2.6:8080/gpfdist/')
FORMAT 'CSV';
